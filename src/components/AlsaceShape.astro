---
import NodePoints from "../assets/node-points.json";

// Limitations for GPS and SVG coordinates
const gpsBounds = {
    minLat: 47.826647,
    maxLat: 49.047029,
    minLon: 6.862870,
    maxLon: 7.748304,
};
const svgBounds = {
    minX: 817.154,
    maxX: 874.953,
    minY: 355.915,
    maxY: 240.635,
};

// Nodes GPS points
// For a possible future feature, you will be able to load points via an API.
const gpsPoints: { lat: number, lon: number }[] = NodePoints;


/**
 * Converts GPS coordinates (latitude and longitude) to corresponding SVG coordinates.
 *
 * The function maps geographical coordinates within a defined GPS bounds (latitudes and longitudes)
 * to a specified SVG coordinate space.
 *
 * @param {number} lat - The latitude value of the GPS coordinate.
 * @param {number} lon - The longitude value of the GPS coordinate.
 * @returns {{cx: number, cy: number}} An object containing the x and y coordinates (cx and cy) in the SVG coordinate space.
 */
function gpsToSvg(lat: number, lon: number): { cx: number; cy: number } {
    const cx = ((lon - gpsBounds.minLon) / (gpsBounds.maxLon - gpsBounds.minLon)) * (svgBounds.maxX - svgBounds.minX) + svgBounds.minX;
    const cy = ((lat - gpsBounds.minLat) / (gpsBounds.maxLat - gpsBounds.minLat)) * (svgBounds.maxY - svgBounds.minY) + svgBounds.minY;
    return {cx, cy};
}

/**
 * Transforms an array of GPS coordinates to include SVG plot coordinates.
 *
 * Each point in the gpsPoints array, which contains latitude and longitude,
 * is processed through `gpsToSvg` to get the corresponding SVG `cx` and `cy` coordinates.
 * The resulting array `svgPoints` contains the original GPS point data along with the
 * derived `cx` and `cy` properties for use in SVG rendering.
 *
 * @type {Array<Object>}
 * @property {number} cx - The x-coordinate in the SVG grid derived from the point's latitude and longitude.
 * @property {number} cy - The y-coordinate in the SVG grid derived from the point's latitude and longitude.
 * @property {number} lat - The latitude of the GPS point.
 * @property {number} lon - The longitude of the GPS point.
 */
const svgPoints: { lat: number; lon: number; cx: number; cy: number }[] = gpsPoints.map(point => {
    const {cx, cy} = gpsToSvg(point.lat, point.lon);
    return {...point, cx, cy};
});

const pointDelay = 200; // in ms
---

<style>
    @keyframes shape {
        0% {
            filter: drop-shadow(0 0 3px #67ea94);
        }
        50% {
            filter: drop-shadow(0 0 5px #67ea94);
        }
        100% {
            filter: drop-shadow(0 0 3px #67ea94);
        }
    }

    @keyframes circle-ping {
        0% {
            r: 1px;
            opacity: 1;
        }
        75%, 100% {
            r: 5px;
            opacity: 0;
        }
    }

    .alsace-shape polygon {
        animation: 7s ease-in-out infinite shape;
        stroke: #67ea94;
        stroke-width: 1;
        fill: transparent;
    }

    .alsace-shape circle {
        fill: #67ea94;
        filter: drop-shadow(0 0 5px #67ea94);
    }
</style>

<svg
        class="alsace-shape"
        xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="805 210 120 200" xml:space="preserve">
    <polygon xmlns="http://www.w3.org/2000/svg"
             points="817.154,355.915 818.453,355.315 819.123,354.945 820.463,353.935 820.614,353.305      820.543,352.675 820.154,351.975 819.663,351.375 819.423,350.695 819.383,350.075 821.003,348.535 821.234,348.005      821.343,347.465 821.533,346.915 821.673,345.765 821.843,343.265 822.053,342.635 822.343,341.985 823.673,340.285      824.283,339.765 824.993,338.985 825.833,338.145 826.973,336.735 827.694,335.195 828.073,334.255 828.573,332.435      828.963,331.315 829.243,330.795 830.944,329.175 831.354,328.625 831.553,328.105 831.703,327.475 831.404,326.855      830.864,326.465 830.303,325.885 830.133,325.315 830.234,324.765 830.543,324.115 830.753,323.485 831.484,322.285      833.064,320.485 833.774,319.415 834.293,318.865 834.663,318.085 835.154,317.515 835.413,316.855 836.533,315.055      836.953,314.535 837.743,313.315 838.024,312.735 838.873,311.435 839.323,310.495 839.644,309.585 839.434,308.905      838.463,307.515 837.793,307.385 837.013,307.465 836.274,307.755 835.633,307.855 834.984,307.855 834.354,307.755      833.173,307.255 832.564,306.765 832.033,306.085 832.053,305.435 832.803,304.175 833.213,303.685 833.323,303.105      833.234,302.505 833.253,301.965 833.173,301.335 833.993,295.835 833.814,295.235 833.024,293.905 832.993,293.275      833.533,292.705 834.163,292.515 834.984,292.415 835.413,291.915 834.873,291.505 834.274,291.215 833.083,290.765      831.774,290.435 831.274,289.835 831.913,289.285 832.713,289.175 834.644,289.155 836.234,288.995 838.333,289.025      839.144,288.765 839.083,288.055 839.173,287.505 839.513,286.935 841.604,286.095 842.383,285.705 843.503,284.485      843.833,283.935 844.093,282.575 844.154,281.925 844.453,280.625 845.274,278.695 845.703,278.195 845.993,277.645      845.923,277.025 845.234,276.685 843.783,276.315 843.184,275.975 842.793,274.775 843.073,274.045 844.743,272.615      845.104,272.035 845.323,271.515 845.713,271.015 846.093,270.285 846.533,269.145 846.663,267.945 846.524,267.215      846.163,266.585 844.073,264.265 843.553,263.815 842.993,263.215 841.953,261.995 840.793,261.545 840.104,261.705      839.604,261.105 839.814,260.005 839.774,259.435 839.644,258.865 839.083,258.545 838.453,258.655 838.024,259.175      837.814,259.775 837.854,260.345 838.203,261.025 837.944,261.625 837.234,262.125 835.913,262.175 835.114,262.355      834.774,262.935 834.633,263.475 834.203,264.545 833.404,265.075 832.673,265.125 832.114,264.655 831.723,263.405      831.684,262.825 831.383,262.145 830.793,262.045 830.194,261.655 829.934,261.025 830.083,260.455 830.623,259.825      831.314,259.695 832.024,259.695 832.843,259.355 833.364,258.835 832.783,258.395 832.154,258.215 831.364,258.025      830.673,258.025 830.024,257.925 829.484,257.535 828.873,257.215 826.314,256.175 825.513,255.655 824.283,254.635      823.973,253.985 823.763,253.385 823.703,252.805 823.973,251.665 824.583,250.405 825.144,249.675 825.703,249.185      827.993,247.745 828.364,247.065 828.293,245.895 828.354,245.325 828.923,243.995 829.373,243.395 830.604,242.325      831.083,241.775 831.083,241.225 830.383,239.975 830.343,239.375 830.923,238.795 831.633,238.565 832.864,238.615      833.383,239.195 833.453,239.765 833.623,240.335 833.694,241.015 834.053,242.425 834.123,243.075 834.383,243.735      834.963,244.175 835.823,244.665 837.163,244.905 839.194,245.405 839.774,245.635 841.114,246.365 844.484,247.065      845.083,247.465 845.163,248.085 845.064,248.765 845.423,249.415 846.053,249.835 846.854,250.145 847.453,250.225      848.083,250.465 848.963,250.515 850.623,250.335 851.453,250.075 854.684,249.605 856.843,248.975 858.293,248.815      858.873,249.025 859.503,249.395 860.043,249.885 861.293,250.745 861.854,251.035 863.213,250.875 863.833,250.405      864.203,249.885 864.823,249.415 865.583,248.195 865.783,247.615 865.734,246.865 865.753,246.315 865.993,245.765      866.644,244.615 867.073,244.065 867.394,243.415 868.564,241.795 869.434,240.175 870.163,240.495 870.883,240.615      871.533,240.415 872.283,240.195 872.404,239.495 873.354,239.915 873.913,239.895 874.243,239.725 874.593,239.775      874.953,240.635 876.093,240.595 876.354,240.585 876.963,240.465 877.453,240.105 877.833,239.595 878.463,239.345      878.823,238.795 879.213,238.795 881.083,240.365 881.343,240.455 882.404,240.815 883.064,241.525 883.484,241.615      884.263,240.925 884.323,240.905 885.033,240.715 885.703,240.745 886.873,240.805 887.413,240.665 887.934,239.795      888.423,239.685 888.614,239.755 889.154,240.535 889.343,240.585 889.623,240.655 889.923,240.915 890.513,241.605      890.913,242.375 890.923,242.385 890.963,242.375 891.793,242.175 892.234,242.065 893.333,242.545 893.684,242.855      895.003,243.215 895.973,243.665 896.843,244.345 897.184,244.925 899.703,246.085 900.184,246.305 901.793,246.785      901.803,246.785 902.743,246.935 902.763,246.935 903.163,246.975 903.253,246.985 903.503,247.005 904.444,247.045      905.053,247.085 905.223,247.085 905.463,247.445 905.944,247.725 906.314,247.775 907.283,247.085 907.564,247.095      908.043,247.715 908.133,247.835 908.213,247.945 905.823,248.805 905.803,248.845 905.194,249.975 904.713,250.865      903.513,252.435 902.694,253.515 902.503,253.765 902.383,254.015 901.793,255.235 901.163,256.525 900.453,257.955      900.473,258.115 900.473,258.125 900.513,258.345 900.314,259.095 900.243,259.355 899.713,261.445 899.234,262.345      898.473,263.375 898.234,263.605 898.223,263.615 898.213,263.625 897.493,264.225 897.484,264.235 896.973,264.475      896.453,264.545 895.723,264.345 895.213,264.375 894.953,264.525 894.923,264.545 894.883,264.565 894.413,265.185      894.383,265.225 894.263,265.755 893.953,266.875 893.774,267.105 892.533,267.665 890.923,267.405 890.543,267.545      890.333,267.825 890.314,267.925 890.213,268.335 890.083,269.025 890.234,269.905 890.053,270.695 889.923,270.895      889.463,271.565 887.604,273.835 887.423,274.025 885.934,275.595 884.694,276.905 881.923,278.395 881.843,278.505      881.703,278.715 881.243,280.315 881.083,280.595 880.413,281.735 880.413,281.745 880.013,282.225 880.003,282.245      879.993,282.255 879.713,282.565 879.524,282.785 879.453,283.035 879.333,283.425 879.173,283.935 879.024,284.425      879.083,284.905 879.144,285.355 879.223,286.005 879.323,286.785 879.413,289.875 879.263,290.755 878.763,291.835      878.083,292.345 877.763,292.445 877.673,292.615 877.033,293.025 876.894,293.565 877.013,295.005 876.553,296.755      876.144,298.125 875.314,299.685 874.573,301.905 874.593,303.515 874.604,304.695 874.753,305.525 874.864,305.775      875.093,306.285 875.314,307.535 875.394,308.275 874.984,308.985 874.203,309.385 873.123,309.715 873.114,309.725      873.003,309.755 872.444,310.145 872.333,310.215 872.064,310.665 871.963,310.815 871.953,310.865 871.793,311.415      871.774,313.045 871.663,313.405 870.904,316.015 870.223,318.325 868.793,319.385 868.394,319.985 868.013,320.985      866.823,323.045 865.783,324.245 865.774,324.255 865.703,324.585 865.663,324.765 865.644,324.835 865.843,325.545      865.694,326.275 864.314,327.615 864.274,327.745 864.263,327.755 864.213,327.935 864.243,328.315 864.314,329.225      864.144,330.705 863.793,331.485 863.864,332.645 863.934,333.635 863.944,333.815 863.793,334.355 863.763,334.475      863.513,335.375 863.524,335.385 864.163,336.325 864.354,336.595 864.763,336.965 865.024,337.445 865.033,337.455      865.073,337.525 865.673,338.045 866.234,338.845 866.243,338.875 866.723,339.895 866.894,340.695 866.793,341.885      866.473,342.425 864.904,344.095 864.633,344.715 864.484,345.765 864.614,347.335 864.444,348.125 864.154,348.615      862.833,349.715 862.623,350.585 862.734,351.095 863.093,352.515 862.963,354.045 862.303,355.085 861.993,355.995      861.904,356.245 860.793,359.515 861.073,361.155 861.333,361.745 861.793,362.775 861.713,364.625 860.194,365.875      859.694,367.115 860.293,370.085 861.144,371.475 862.803,373.375 862.963,373.565 863.283,374.195 863.564,374.725      863.973,376.665 864.303,378.205 864.184,378.195 863.524,378.155 863.343,377.855 863.003,377.865 862.694,377.885      862.373,377.895 862.283,377.925 862.194,378.045 861.703,378.685 861.623,378.795 861.413,379.075 860.713,380.285      860.354,380.675 860.123,380.915 858.864,382.255 858.663,383.745 859.513,384.625 859.644,385.425 859.314,385.945      858.823,386.745 857.963,387.295 857.453,387.445 857.064,387.355 856.894,387.055 854.934,385.875 854.253,385.815      853.303,387.235 854.033,387.455 854.783,387.495 855.303,387.985 855.263,388.475 854.953,388.755 854.633,388.695      854.213,389.225 853.033,390.675 852.833,390.845 852.073,391.455 851.354,391.805 849.973,391.885 849.194,391.695      848.053,391.405 846.654,391.495 846.434,391.505 843.654,392.075 842.413,392.995 841.814,392.825 841.343,391.945      840.753,391.585 839.053,391.585 838.873,391.545 837.783,391.245 837.053,390.805 837.314,390.085 837.503,388.975      838.184,387.095 838.043,386.675 837.064,386.955 836.263,386.945 835.203,385.945 835.194,385.935 835.453,385.295      835.543,384.745 835.463,383.595 835.354,382.945 834.854,381.665 834.373,380.985 833.864,380.435 833.343,380.045      832.154,378.925 831.873,378.195 831.463,377.435 830.923,377.045 830.383,376.785 829.723,376.765 829.114,376.835      827.814,377.155 827.213,376.835 826.654,376.105 826.614,375.535 826.723,374.985 827.383,373.895 828.293,372.925      828.944,371.545 829.243,370.365 829.303,369.015 829.093,367.085 828.793,365.725 827.993,364.235 827.473,363.505      826.203,362.565 825.073,362.125 823.673,361.735 820.984,360.635 818.024,359.015 816.873,358.265 816.383,357.615      816.314,356.955 816.533,355.995 816.553,355.995    "/>

    {svgPoints.map(({cx, cy}, index) => (
            <circle
                    id={'node_point_' + index}
                    cx={cx}
                    cy={cy}
                    r="2"
                    style={{
                        animationDelay: `${((index % 10) - 5) * pointDelay}ms`, // Recommencer Ã  0 tous les 10 points
                        animationName: "circle-ping",
                        animationDuration: "2s",
                        animationTimingFunction: "ease-in-out",
                        animationIterationCount: "infinite",
                    }}
            />
    ))}



</svg>